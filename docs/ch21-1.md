# 21.1 Finite Difference Algorithms


## Definitions

By definition, **Finite Differencing** is a method to _approximate_ partial differential equations which we cannot solve, into a system of algebraic equations which we can.

Notation to simplify our representations:

 - Superscripts: We use superscripts to denote steps in the time domain \( t^n = n \Delta t \). Here \( n = [0, N] \) is the step index and \( \Delta t \) is the time-step \( T/N \)
 - Subscripts: \( x_j = j \Delta x \). Here \( j = [0, J] \) is the step index and \( \Delta x = L/J \) is the spatial step.
 - Together: \( u_j ^n = u(t^n, x_j) \)
 - **Explicit** algorithms: Use data that is already known at the present time to advance the solution to the next time step. They are easier and faster to implement, but they introduce stability constraints.
    $$
    u_j ^{n+1} = f(u_j ^n, u_{j+1} ^n , u_{j+2} ^n \ldots)
    $$
 - **Implicit** algorithms: Use data from the next time step when advancing the solution. Leads to a system of equations that must be solved simultaneously
    $$
    u_{j} ^{n+1} = f(u_{j} ^n , u_{j+1} ^{n+1}, u_{j-1} ^{n+1}, \ldots)
    $$

One look at the typical definition of the derivative suggests an algebraic approximation

$$
\dv{f}{x} = \lim_{\Delta x \rightarrow 0} \frac{f(x + \Delta x) - f(x)}{\Delta x} \quad \rightarrow \quad \dv{f}{x} \approx \frac{f(x + \Delta x) - f(x) }{\Delta x}
$$

Applying to our model equation, the linear advection equation

$$
\pdv{u}{t} + c \pdv{u}{x} = 0
$$

The first-order forward difference approximation for the temporal derivative is
$$
\pdv{u}{t} \approx \frac{u_j ^{n+1} - u_j ^n}{\Delta t} \equiv \Delta _t u
$$
And the first-order backward approximation for \( \pdv{u}{x} \) is
$$
\pdv{u}{x} \approx \frac{u_{j} ^n - u_{j-1} ^n}{\Delta x} \equiv \nabla _x u
$$
These are sometimes called Euler differencing, since they are first-order. Plugging in our approximations, we arrive at the "Forward Euler Algorithm"

$$
\frac{u_{j} ^{n+1} u_j ^n}{\Delta t} + c \frac{u_{j} ^n - u_{j-1} ^n}{\Delta x} = 0
$$
This is an explicit scheme: solve for \( u^{n+1} _j  \) 
$$
u_j ^{n+1} = u_j ^n - \frac{c \Delta t}{\Delta x} (u_j ^n - u_{j-1} ^n)
$$

The multiplier out front \( \frac{c \Delta t}{\Delta x} \) is very important for stability, so we call it

$$
\frac{c \Delta t}{\Delta x} = \text{ Courant number (or CFL number)}
$$

For the problem to be mathematically well-posed, we must know initial conditions and boundary conditions
$$
u(t = 0, j) \qquad u(t, x = 0)
$$

## Accuracy

We can be more precise with the error in our difference approximation: the error will be on the order of \( \Delta x \):

$$
\dv{f}{x} \approx \frac{f(x + \Delta x) - f(x) }{\Delta x}
$$

$$
\rightarrow \dv{f}{x} = \frac{f(x + \Delta x) - f(x) }{\Delta x} + O(\Delta x)
$$

As it turns out, we can improve the accuracy of the finite difference operators by using centered differences:

$$
\left. \pdv{u}{x} \right|_{j} = \frac{u_{j+1} ^n - u_{j-1} ^n}{2 \Delta x} + O(\Delta x ^2)
$$

So the forward-time, centered-space (FTCS) PDE becomes
$$
\frac{u_j ^{n+1} - u_j ^n}{\Delta t} + c \frac{u_{j+1} ^n - u_{j-1} ^n }{2 \Delta x} = 0
$$

This is more accurate than the Euler method in space. We can write the accuracy as \( O(\Delta t, \Delta x^2) \), or "it is first-order accurate in time and second-order accurate in space."

How do we get accuracy estimates? The accuracy is defined by using a Taylor series expansion for the finite-difference operators:

$$
u_j ^{n+1} = u_j ^n + \pdv{u}{t} \Delta t + \frac{1}{2} \pdv{ ^2 u}{t^2} \Delta t^2 + \frac{1}{6} \pdv{ ^3 u}{t ^3} \Delta t^3 + \ldots
$$
$$
u_{j+1} ^n = u_j ^n + \pdv{u}{x} \Delta x + \frac{1}{2} \pdv{ ^2 u}{x^2} \Delta x^2 + \frac{1}{6} \pdv{ ^3 u }{x ^3} \Delta x ^3 + \ldots
$$
$$
u_{j-1} ^n = u_j ^n - \pdv{u}{x} \Delta x + \frac{1}{2} \pdv{ ^2 u }{x^2} \Delta x^2 - \frac{1}{6} \pdv{^3 u }{x^3} \Delta x ^3 + \ldots 
$$

Substituting into the Forward Euler algorithm:

$$
u_j ^n + \pdv{u}{t} \Delta t + \frac{1}{2} \pdv{^2 u }{t^2} \Delta t^2 + \frac{1}{6} \pdv{ ^3 u}{t ^3} \Delta t^3 + \ldots
$$
$$
= u_j ^n - \frac{c \Delta t}{\Delta x} \left( u_j ^n - \left[ u_j ^n - \pdv{u}{x} \Delta x + \pdv{^2 u }{x^2} \frac{\Delta x ^2}{2} \pm \ldots \right] \right)
$$

After simplifying and re-arranging/canceling like terms, we get

$$
\pdv{u}{t} + c \pdv{u}{x} = - \frac{1}{2} \pdv{^2 u}{t^2} \Delta t - \frac{1}{6} \Delta t^2 + \ldots + \frac{c}{2} \pdv{^2 u}{x^2} \Delta x - \frac{c}{6} \pdv{ ^3 u }{x ^3} \Delta x ^2 + \ldots
$$

The left-hand side is the PDE we're trying to solve, so everything on the right-hand side is the error term introduced by our approximation. The solution we're going to get is actually the solution to the modified PDE with all of the error terms.  Reading off the lowest-order terms of \( \Delta x \) and \( \Delta t \) we see that the algorithm is first-order accurate in space and time.